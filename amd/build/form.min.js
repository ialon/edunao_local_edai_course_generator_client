define([], function() {
    return {
        init: function() {
            const button = document.getElementById('generate_course');
            const loader = document.getElementById('loader');
            const coursedescription = document.getElementById('course_description');

            button.addEventListener('click', function() {
                const description = coursedescription.value;
                button.disabled = true;
                loader.classList.replace('d-none', 'd-flex');

                fetch(`${M.cfg.wwwroot}/local/edai/ajax/generate_course.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'description=' + encodeURIComponent(description)
                })
                    .then(response => {
                        if (!response.ok) { // Check if response status is not OK
                            throw new Error('Server responded with status: ' + response.status);
                        }
                        return response.json(); // Parse JSON only if response is okay
                    })
                    .then(courseid => {
                        window.location.href = `${M.cfg.wwwroot}/course/view.php?id=${courseid}`;
                    })
                    .catch(error => {
                        alert('Error generating course: ' + error.message);
                    })
                    .finally(() => {
                        button.disabled = false;
                        loader.classList.replace('d-flex', 'd-none');
                    });
            });
        }
    };
});
